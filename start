#!/bin/bash

# Name for simulator container
SIM_CONTAINER_NAME=codecharacterbackend_sim_1

# Remove the existing containers
docker rm -f `docker ps -aq`

# Launch app, web, and db containers
docker-compose up --build -d

# Run the simulator container
docker run -td -P \
    -w "/var/www/code-character/sim/" \
    --name $SIM_CONTAINER_NAME \
    -v $(pwd)/simulator:/var/www/code-character/sim python:latest

# Addition package installations
docker network connect codecharacterbackend_default $SIM_CONTAINER_NAME
docker exec $SIM_CONTAINER_NAME apt-get update -y
docker exec $SIM_CONTAINER_NAME apt-get install cmake python-pip -y
docker exec $SIM_CONTAINER_NAME pip install sqlalchemy pymysql

# Run the python watcher script
docker exec $SIM_CONTAINER_NAME python test.py
